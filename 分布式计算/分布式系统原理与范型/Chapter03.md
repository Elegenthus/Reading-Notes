# Chapter03

* 线程
    * 线程的实现
        * 可以构造一个完全在用户模式下执行的线程库
            * 用户级线程
                * 优点
                    * 创建销毁线程开销小，主要开销为线程堆栈建立而分配的内存以及销毁线程时释放线程堆所占用的内存
                    * 使用数量较少的几条指令实现线程上下文切换
                * 缺点
                    * 对阻塞系统的调用会组设线程所属的整个进程，也阻塞了所属进程中的所有其他线程
        * 由内核来掌管线程并进行调度
            * 内核实现线程
                * 优点
                    * 阻塞系统的调用不会影响到其他部分的执行
                * 缺点
                    * 每一个线程操作都需要由内核执行，加大线程上下文切换开销
        * 采用用户级线程和内核级线程的混合形式
            * 轻量级进程LWP
                * 运行在单个重量级进程的上下文中
            * 系统还额外提供用户级线程包，提供创建和销毁线程的普通操作，包中提供了用于线程同步的工具
* 虚拟化
    * 只有单个处理器但感觉有多个处理器
    * 本质是拓展或替换一个现存界面来模仿另一个系统的行为
* 客户
    * 任务：让个人用户和远程服务器相交互
    * 复合文档：定义为一组文档在用户接口层上做到了无缝集成
    * 客户端不应察觉到与其进行通信的远程进程
* 服务器
    * 组织结构分类
        * 迭代服务器：自己处理请求，并且在有必要的情况下将响应返回给发出请求的客户
        * 并发服务器：自己不处理请求，将请求传递给某个独立线程或者其他进程来处理，自身立即返回并等待下一个输入
    * 服务器集群
        * 一组经网络连接的机器，每台机器运行一个或多个服务器
    * 分布式服务器
        * 同一个主机名可以对应多个访问点地址，但用户感觉不出差别
* 管理服务器集群
    * 通用方式：把单台服务器的管理功能拓展到服务器集群。使管理员能从远程客户登录到集群的一个节点并执行本地管理命令 -> 在一台管理机器上提供界面允许从一个或多个服务器收集信息、升级组件、增减结点。
* 代码迁移
    * 理由：使得分布式系统中负载均衡，提升系统的整体性能
    * 代码迁移模型
        * 框架结构
            * 代码段
            * 资源段
            * 执行段
        * 区分方式1
            * 弱可移动性：只能传输代码段和某些初始化数据，传输过来的程序只能从预先定义的几个位置之一开始执行
            * 强可移动性：可以传输执行段。可以停止运行中进程，移至另一台机器上，再从刚才中断的位置继续执行
        * 区分方式2（基于区分方式1）
            * 发送者启动：代码当前驻留在哪台机器上或者正在哪台机器上执行，就由该机器来启动迁移
            * 接受者启动：代码迁移的主动权掌握在目标机器手中
    * 迁移与本地资源（由强到弱）
        * 进程对资源的绑定方式
            * 按标识符绑定
            * 按值绑定
            * 按类型绑定
        * 资源对机器的绑定方式->资源是否能与代码一起迁移到目标机器上去
            * 未连接资源
            * 附着连接资源
            * 紧固连接资源
            * ![](../../pictures/distribution_code_tie.PNG)

## 课后习题
* 比较使用单线程文件服务器读取文件和使用多线程服务器读取文件有什么不同。花费15ms来接收请求、调度该请求并且完成其他必须的处理工作，假定需要的数据存放在主存储器的缓存中。如果需要磁盘操作，就需要额外多花75ms，在磁盘操作的过程中线程处于睡眠状态。如果服务器采用单线程的话，它每秒能处理多少个请求？如果采用多线程呢？
    * 单线程文件中，命中Cache花了15ms，未命中Cache花了(15+75)=90ms，加权平均值`1/3*90+2/3*15=40ms？？？`，每秒处理1000/40 = 25个；多线程文件中，磁盘等待交迭进行，每秒处理1000/15 = 66个
* 代理可以通过调用所有副本来支持引用透明性。能否对（服务器端的）对象的副本进行调用？
    * 可以。当一个副本对象A调用一个对象B，那么A的每一个副本都会执行B的调用，但B应只能被调用一次
* 维护到客户的TCP/IP连接的服务器是状态相关的还是状态无关的？
    * 如果服务器没有在客户端保存其它信息，则认为服务器是状态无关的。
* 考虑某个进程P，它请求访问与自己位于同一台机器上的本地文件F。在P迁移到另一台机器上以后，它还要访问F。如果文件对机器的绑定是紧固的，如何实现对F的系统级调用？
    * 创建一个进程Q，用Q来处理对F的远程访问，提供给进程P和以前同样的接口 -> Q是作为文件服务器来使用的