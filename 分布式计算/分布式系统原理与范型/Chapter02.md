# Chapter02

* 区分
    * 软件体系结构：更关注软件的逻辑结构
    * 系统体系结构：可以把组成分布式系统的组件放在不同的机器上

## 体系结构的样式
* 一个样式反应了组织构成分布式系统的软件组件之间的接口时所遵循的基本原则
* 基于对象的体系结构 
    * 每个对象对应一个组件，组件之间通过（远程）过程调用机制连接
    * 是大型软件系统最重要的样式
* 以数据为中心的体系结构
    * 依赖于一个共享的分布式文件系统，通信通过文件虚拟发生
* 基于事件的体系结构
    * 进程通过事件传播通信，事件传播可以有选择性携带数据
    * 发布/订阅系统
    * 优点：进程松散耦合，无需明确引用对方 -> 引用去耦

## 系统体系结构
* 集中式体系结构
    * 应用分层
        * 用户接口层
        * 处理层
        * 数据层
    * 客户-服务器模型
        * 幂等：某个操作可以重复多次而无害
    * 多层体系结构
        * （物理）三层体系结构
            * 用户接口
            * 应用程序服务器
            * 数据库服务器
* 非集中式体系结构
    * 点对点系统：进程组织为一个覆盖网络，其中的每个进程都有一个与之通信的其他对等体列表
    * 垂直分布性：多层客户-服务器把应用程序分成用户接口、处理组件和数据层
    * 水平分布性：客户或服务器可能在物理上被分割成逻辑上相等的几个部分
    * 上下文可编址网络CAN
    * 非结构化的点对点体系结构
        * 依靠随机化的算法来构造覆盖网络
        * 。。。。
    * 覆盖网络的拓扑管理
        * 可以为进程间的消息路由部署确定方案
    * 超级对等体：能够维护一个索引或充当一个代理程序的结点，为驻留web网页提供存储空间，让web客户能访问最近的页面
* 混合体系结构
    * 边界服务器系统
        * 因特网服务提供商ISP
        * 目的：在进行过滤和编码转换后提供内容服务
    * 协作分布式系统
        * 查找某个文件时可以从其他用户那里下载文件块直到下载的文件块能组成完整的文件为止
## 体系结构与中间件
* 中断器
* 软件自适应的基本技术
    * 要点分离：吧实现功能的部分与负责诸如可靠性、性能、安全等其他事情的部分分开
    * 计算映像：程序检查自己，根据需要调整其行为
    * 基于组件的设计：通过组件的不同组合来支持自适应
## 分布式系统的自我管理
* 分布式系统是自适应的，但主要是调整运行行为而不是软件组件。
* 反馈控制模型
    * 一个监视组件
    * 一个分析组件
    * 多种工具集

## 课后系统
* 假设进程链P1,P2,...Pn实现了一个多层客户-服务器体系结构。进程Pi是进程Pi+1的客户，只有在从Pi+1接收了一个回复后，Pi才会返回一个回复给Pi-1。当我们查看进程Pi处的请求-回复性能时，会发现这种体系结构的主要问题是什么?
    * 如果n很大，性能会很差。如果其中某一层性能很差或者临时不可达将会立即使得导致整个性能降低
* 在结构化的覆盖网络中，消息是根据覆盖的拓扑结构来路由的。这种方法的主要缺点是什么？
    * 增加查找信息的成本。如果一个节点只包含邻接节点的信息，那么有时可能需要通过多个邻接节点才能找到信息；如果一个节点包含所有节点的信息，可以实现节点的任意查找，根据本地信息一次定位,但增加了节点维护应用层路由表的负担。
    * 逻辑距离很短的两个节点可能物理距离很长
* 在非结构化的覆盖网络中，每个结点随机地选择c个邻结点。如果P和Q都是R的邻结点，那么P和Q互为邻结点的概率是多少？
    * 2c/(n-1) 其中n是网络中所有的节点数  -> 网答
    * (c*c)/[(n-1)*(n-1)] -> 我答
* 在BitTorrent系统中，每个结点具有一个带宽为Bout的输出链接，以及一个带宽为Bin的输入连接。这些结点中的一些可以自愿为其他结点提供下载文件。如果假设在某个时候，一个BitTorrent系统最多只有一个种子结点，那么它的最大下载带宽是多少？
    * S * Bout / N + Bout 假设有S个种子，N个客户端，每个客户端随机选择种子，种子节点结合的输出带宽是S*Bout，每个客户端有S*Bout/N的直接下载带宽，如果客户端相互协作，每个能在下载数据块时达到Bout，由于tit-for-tat（以牙还牙策略），一个BitTorrent的客户端的下载带宽主要取决于他的输出带宽。所以整体的下载带宽为 S*Bout/N+Bout

# 辨析
* 结构化和非结构化模型的根本区别在于每个节点所维护的邻居是否能按照某种全局方式组织起来以利于快速查找
* 纯P2P非结构化网络模型
    * 也被称为广播式P2P模型，对等节点之间的内容查询和分享是通过相邻节点广播接力完成的。每个用户`随机`接入网络，并与自己相邻的一组邻居节点通过端到端连接，构成一个逻辑覆盖的网络
    * 查询节点发出一个查询请求直接广播到所连接的邻居节点，如果邻居节点不能满足要求，则以同样的广播方式请求各自相连的邻居节点，以此类推
    * 防止搜索环路的产生，每个节点会记录搜索轨迹
    * 例如Gnutella模型，采用了完全随机图的泛洪发现和随机转发机制，通过IP多播技术让对等节点定期发布资源和传播查询
    * 优点
        * 完全的分布式使之具有最大的容错性，不会出现单点崩溃现象
        * 能潜在的获取最多的查询结果
    * 缺点
        * 整个网络的拓展性较差，随着对等节点的数量增加，网络可能存在过多的查询而发生阻塞
        * 由于没有中央目录服务器对用户进行管理，因此缺乏较好的集中控制和策略
        * 查询的有效期和正确性都不能保证
        * 能力有限的对等节点容易造成系统瓶颈
        * 网络中对等节点的查找和定位比较复杂，效率低下
* 纯P2P结构化网络模型
    * 结构化P2P网络模型是一种采用纯分布式的消息传递机制和根据关键字进行查找的定位服务。其中，节点维护的邻居是有规律的，P2P网络的拓扑结构是严格收到控制的，信息资源将有规律的组织放到合适的节点，查询以较少的跳数，路由到负责所查询信息资源的节点上
    * 结构化P2P的主流方法：散列表（DHT）技术，是目前拓展性最好的P2P路由范式之一。在非结构化的P2P系统中加入了人为的控制策略，把整个系统的工作重点放在如何有效地查找信息上
    * 优点
        * 由于DHT各节点并不需要维护整个网络的信息，只在节点中存储其邻近的各节点信息，因此较少的路由信息就可以有效的实现到达某个节点
        * 取消了泛洪算法，利用分布式散列表进行定位查找，可以有效地减少节点信息的发送数量，从而增强了P2P网络的扩展性
        * 出于冗余度以及延时的考虑，大部分DHT总是在节点的虚拟标识与关键字最接近的节点上复制备份冗余信息，这样也避免了单一节点失效的问题
        * 使用者匿名，数据传输加密
    * 缺点
        * 维护机制复杂，尤其是节点频繁加入、退出造成的网络波动会极大增加DHT的维护代价
        * 仅支持精确关键字匹配查找，无法支持内容/语义等查找
        * 结构化P2P网络模型，由于自身算法的限制，不适合超大型的P2P系统
* 参考：[P2P网络——网络模型概述](https://my.oschina.net/jos/blog/823770)